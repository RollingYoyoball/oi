好的这题。。第二次做了但是还是有点懵自己想不到唉qwq

嗯反过来想会容易很多
f[i][0]表示的是i不能通过自己本身或者自己的子树充上电的概率
f[i][1]表示的是i不能通过父亲充上电的概率

稍微想一下就发现一个点能否充上电的情况可以从父亲转移过来也可以从子树转移过来
所以。。就两遍dfs咯

首先先将f[i][0]求出来，这个是比较好求的
再定义一个数组cantf[i]表示第i个点不能给父亲充上点的概率
那么cantf[i]=f[i][0]（本身就不能充上电）+(1-f[i][0])*(1-a[i].p)（自己充上电了，但是通向父亲的导线不能通电）
然后f[i][0]=所有的cantf[son]的乘积啦

然后就是f[i][1]
定义一个cantson表示x不能给儿子u充上电的概率，
那么，cantson=(前面的判断是防止出现/0的情况）f[x][1]*(f[x][0]/cantf[u])（x自己不能从父亲那里充上电，并且也不能从其他的儿子那里充上电）
因为当前在计算跟u有关的信息，所以u的贡献不能算进去
然后f[u][1]=cantson（x不能给u充上电）+(1-cantson)*(1-a[i].p)（x能给u充上电，但是导线不通）
最后的ans显然就是sum(1-f[i][0]*f[i][1](既不能从父亲充到电也不能从儿子充到电))，1减去可能性之后就是从父亲或者儿子充到电的概率啦
然后就做完了，棒